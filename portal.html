<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Festival de Teatro do Recife • Catálogo</title>
    <link
      rel="icon"
      href="https://statics.recife.pe.gov.br/images/dynamics/conecta/icons/favicon.png?w=32&h=32&fit=fill&border=2,transparent,shrink"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* manter todo o CSS existente exatamente como fornecido,
         pois já está alinhado com a identidade visual da PCR */
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }
      *,
      *::before,
      *::after { box-sizing: border-box; }
      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }
      header.site-header {
        background: url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000") center/cover no-repeat;
        color: #fff;
        padding: 3rem 0 2.25rem;
      }
      header .lead {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        line-height: 1.65;
        max-width: 100%;
      }
      .badge-open {
        display: inline-flex; align-items: center; gap: .5rem;
        font-size: .95rem; font-weight: 600; padding: .45rem .9rem; border-radius: 999px;
        background: rgba(255,255,255,.14);
      }
      .section-title {
        display: flex; align-items: center; gap: .65rem; font-weight: 700; font-size: 1.2rem; color: var(--text-strong);
      }
      .section-title::before { content: ""; display: inline-block; width: 32px; height: 3px; border-radius: 999px; background: var(--brand-highlight); }
      .card { border-radius: 4px; overflow: hidden; }
      .card-programa {
        border: 1px solid rgba(0,83,164,.08); border-radius: 4px; background: var(--surface-strong);
        box-shadow: 0 16px 34px rgba(0,45,98,.08);
      }
      .card-programa .card-header {
        border-bottom: 1px solid rgba(0,83,164,.08);
        background: linear-gradient(180deg,#fff 0%,#f5f8fc 100%);
        padding: 1.25rem 1.25rem 1rem;
      }
      .muted { color: var(--text-muted); }
      .catalog-grid { row-gap: 1.25rem; }
      .play-card .ratio { background: #e9eef7; }
      .play-card .badge { font-weight: 600; }
      .btn-fav[aria-pressed="true"] .fav-icon { filter: saturate(1.4); }
      .offcanvas .list-group-item small { color: var(--text-muted); }
      /* manter os estilos responsivos existentes… */
      /* …demais regras (tabelas, recibo etc.) podem permanecer sem uso, não remover */
    </style>
</head>
<body class="theme-catalogo">
  <style>
    body.theme-catalogo {
      background: radial-gradient(circle at top, #182034 0%, #0b1020 60%, #05070f 100%);
      color: #e3ebff;
    }

    a,
    a:hover {
      color: var(--brand-highlight);
    }

    header.site-header {
      background: linear-gradient(135deg, rgba(0, 28, 60, 0.92) 0%, rgba(3, 10, 25, 0.92) 100%),
        url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000") center/cover no-repeat;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding: 3rem 0 2.5rem;
    }

    .catalog-brand {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .brand-mark {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: rgba(0, 163, 255, 0.16);
      border: 1px solid rgba(0, 163, 255, 0.45);
      display: grid;
      place-items: center;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: #70c8ff;
      text-transform: uppercase;
    }

    .catalog-nav {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .catalog-nav button {
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(12, 20, 40, 0.6);
      color: #d6e2ff;
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .catalog-nav button.active,
    .catalog-nav button:focus {
      border-color: var(--brand-highlight);
      box-shadow: 0 0 0 0.15rem rgba(0, 163, 255, 0.2);
    }

    .badge-open {
      background: rgba(0, 163, 255, 0.18);
      color: #8fd4ff;
    }

    header .lead {
      color: rgba(226, 235, 255, 0.82);
    }

    .btn-favoritos {
      background: rgba(0, 163, 255, 0.14);
      border: 1px solid rgba(0, 163, 255, 0.4);
      color: #8fd4ff;
      border-radius: 999px;
      padding: 0.65rem 1.25rem;
      font-weight: 600;
    }

    .btn-favoritos .badge {
      background: rgba(0, 163, 255, 0.35) !important;
      color: #e3f3ff;
    }

    .btn-favoritos:hover,
    .btn-favoritos:focus {
      background: rgba(0, 163, 255, 0.24);
      color: #e3f3ff;
    }

    .section-title {
      color: #f2f5ff;
    }

    .catalog-toolbar {
      background: rgba(15, 22, 38, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 22px 46px rgba(3, 10, 26, 0.6);
    }

    .catalog-toolbar label {
      color: #7f8dab;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .catalog-toolbar .form-control,
    .catalog-toolbar .form-select {
      background: rgba(5, 10, 22, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #e3ebff;
      border-radius: 12px;
      padding: 0.75rem 1rem;
    }

    .catalog-toolbar .form-control::placeholder {
      color: #6e7ba1;
    }

    .catalog-toolbar .form-select option {
      background: #0f1626;
      color: #e3ebff;
    }

    .catalog-toolbar .btn-outline-secondary {
      color: #e3ebff;
      border-color: rgba(255, 255, 255, 0.12);
      border-radius: 12px;
    }

    .catalog-toolbar .btn-outline-secondary:hover,
    .catalog-toolbar .btn-outline-secondary:focus {
      background: rgba(0, 163, 255, 0.18);
      border-color: var(--brand-highlight);
      color: #e3f3ff;
    }

    .catalog-grid {
      row-gap: 1.75rem;
    }

    .month-divider {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.85rem;
      color: #7f8dab;
      margin: 1.5rem 0 0.5rem;
    }

    .play-card {
      background: rgba(15, 22, 38, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .play-card:hover,
    .play-card:focus-within {
      transform: translateY(-4px);
      box-shadow: 0 18px 40px rgba(3, 10, 26, 0.45);
    }

    .poster-wrapper {
      position: relative;
      background: #0d1424;
    }

    .poster-badge {
      position: absolute;
      top: 0.8rem;
      left: 0.8rem;
      background: rgba(5, 11, 22, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 0.4rem 0.6rem;
      text-align: center;
      line-height: 1.1;
      min-width: 3.1rem;
    }

    .poster-badge .day {
      display: block;
      font-size: 1.2rem;
      font-weight: 700;
      color: #f2f6ff;
    }

    .poster-badge .month {
      display: block;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      color: #7f8dab;
    }

    .poster-badge .weekday {
      display: block;
      font-size: 0.65rem;
      text-transform: uppercase;
      color: #4d5c80;
    }

    .play-card .badge {
      background: rgba(0, 163, 255, 0.18);
      color: #8fd4ff;
    }

    .play-card .muted {
      color: #7f8dab;
    }

    .card-text {
      color: rgba(227, 235, 255, 0.84);
    }

    .catalog-meta {
      display: grid;
      gap: 0.35rem;
      font-size: 0.78rem;
      color: #7f8dab;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      padding-top: 0.75rem;
      margin-top: 1rem;
    }

    .catalog-meta span {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      letter-spacing: 0.02em;
    }

    .catalog-meta strong {
      color: #d9e3ff;
      font-weight: 600;
    }

    .btn-detalhes {
      background: var(--brand-highlight);
      border-color: var(--brand-highlight);
    }

    .btn-detalhes:hover,
    .btn-detalhes:focus {
      background: #1cb3ff;
      border-color: #1cb3ff;
    }

    .btn-fav {
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border: 1px solid rgba(255, 255, 255, 0.12);
      color: #d6e2ff;
      background: rgba(8, 14, 28, 0.5);
    }

    .btn-fav .fav-icon {
      font-size: 0.9rem;
    }

    .btn-fav:hover,
    .btn-fav:focus {
      border-color: var(--brand-highlight);
      color: #e3f3ff;
    }

    .btn-fav[aria-pressed="true"] {
      background: rgba(0, 163, 255, 0.18);
      border-color: var(--brand-highlight);
      color: #8fd4ff;
    }

    .offcanvas,
    .offcanvas .offcanvas-header {
      background: #0f1626;
      color: #e3ebff;
    }

    .offcanvas .list-group-item {
      background: rgba(13, 20, 34, 0.8);
      border-color: rgba(255, 255, 255, 0.05);
      color: #d6e2ff;
    }

    .offcanvas .badge {
      background: rgba(0, 163, 255, 0.18);
      color: #8fd4ff;
    }

    .offcanvas .btn-link {
      color: #ff8f9a;
    }

    .modal-content {
      background: #0f1626;
      color: #e3ebff;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .modal-header,
    .modal-footer {
      border-color: rgba(255, 255, 255, 0.1);
    }

    .modal .muted {
      color: #7f8dab;
    }

    .highlight-pill {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 999px;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #aebce0;
    }

    footer {
      background: rgba(8, 13, 26, 0.9);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      color: #7f8dab;
    }

    footer a {
      color: inherit;
    }

    @media (max-width: 575.98px) {
      header.site-header {
        padding-bottom: 2rem;
      }

      .catalog-toolbar {
        padding: 1.25rem;
      }

      .catalog-nav button {
        font-size: 0.75rem;
      }
    }
  </style>
  <header class="site-header">
    <div class="container">
      <div class="d-flex flex-column gap-4">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-4">
          <div class="catalog-brand">
            <div class="brand-mark" aria-hidden="true">FT</div>
            <div>
              <span class="badge-open">Programação aberta</span>
              <h1 class="display-5 fw-bold mt-3 mb-2">Festival de Teatro do Recife</h1>
              <p class="lead mb-0">Catálogo cinematográfico dos espetáculos da edição 2024 • 14 a 29 de setembro • Escolha sua peça, horário e favoritos.</p>
            </div>
          </div>
          <div class="d-flex flex-column gap-3 align-items-lg-end w-100 w-lg-auto">
            <div class="catalog-nav" role="group" aria-label="Atalhos de filtro">
              <button type="button" class="active" aria-pressed="true" data-action="reset">Todos</button>
              <button type="button" aria-pressed="false" data-action="focus-busca">Data</button>
              <button type="button" aria-pressed="false" data-action="focus-teatro">Status</button>
              <button type="button" aria-pressed="false" data-action="focus-classificacao">Gênero</button>
              <button type="button" aria-pressed="false" data-action="buscar-direcao">Direção</button>
              <button type="button" aria-pressed="false" data-action="buscar-elenco">Elenco</button>
            </div>
            <button class="btn btn-favoritos align-self-lg-end" type="button" data-bs-toggle="offcanvas" data-bs-target="#favoritosOffcanvas" aria-controls="favoritosOffcanvas">
              Meus favoritos <span class="badge text-bg-primary ms-2" id="favoritos-count">0</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="py-4">
      <div class="container">
        <div class="catalog-toolbar">
          <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
            <h2 class="section-title mb-0">Filtrar programação</h2>
            <p class="mb-0 text-uppercase small text-white-50">Explore o catálogo e refine sua busca pelas produções.</p>
          </div>
          <form class="row g-3 align-items-end" id="filtrosForm">
            <div class="col-12 col-lg-4">
              <label for="filtroBusca" class="form-label">Busca</label>
              <input type="search" class="form-control" id="filtroBusca" placeholder="Nome da peça, teatro ou sinopse" aria-label="Buscar por peça">
            </div>
            <div class="col-12 col-md-4 col-lg-3">
              <label for="filtroTeatro" class="form-label">Teatro</label>
              <select class="form-select" id="filtroTeatro" aria-label="Filtrar por teatro">
                <option value="">Todos os teatros</option>
              </select>
            </div>
            <div class="col-12 col-md-4 col-lg-3">
              <label for="filtroClassificacao" class="form-label">Classificação</label>
              <select class="form-select" id="filtroClassificacao" aria-label="Filtrar por classificação etária">
                <option value="">Todas as classificações</option>
              </select>
            </div>
            <div class="col-12 col-md-4 col-lg-2 d-grid">
              <button type="button" class="btn btn-outline-secondary" id="limparFiltros">Limpar filtros</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <section class="pb-5">
      <div class="container">
        <h2 class="section-title mb-4">Catálogo de peças</h2>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3 catalog-grid" id="catalogo"></div>
      </div>
    </section>
  </main>

  <div class="modal fade" id="detalhesModal" tabindex="-1" aria-labelledby="detalhesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detalhesModalLabel">Detalhes da peça</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <div class="col-12 col-md-5">
              <div class="ratio ratio-2x3">
                <img src="" alt="" class="w-100 h-100" style="object-fit: cover;" id="modalPoster">
              </div>
            </div>
            <div class="col-12 col-md-7">
              <h3 class="h4" id="modalTitulo"></h3>
              <div class="d-flex flex-wrap align-items-center gap-3 mb-3">
                <span class="badge text-bg-primary" id="modalClassificacao"></span>
                <span class="text-uppercase muted small" id="modalData"></span>
                <span class="text-uppercase muted small" id="modalHorario"></span>
              </div>
              <p class="mb-3"><strong>Teatro:</strong> <span id="modalTeatro"></span></p>
              <div class="d-flex flex-wrap gap-2 mb-3" id="modalHighlights"></div>
              <h6 class="fw-semibold">Sinopse</h6>
              <p id="modalSinopse" class="mb-3"></p>
              <div id="modalFichaTecnica" class="d-none">
                <h6 class="fw-semibold">Ficha técnica</h6>
                <p class="mb-0" id="modalFichaTexto"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="favoritosOffcanvas" aria-labelledby="favoritosOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="favoritosOffcanvasLabel">Peças favoritas</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <div class="list-group mb-3" id="favoritosLista"></div>
      <p class="muted small" id="favoritosEmpty">Nenhuma peça favorita ainda. Clique em “Favoritar” para montar sua lista.</p>
    </div>
  </div>

  <footer class="py-4">
    <div class="container text-center small">
      Secretaria de Cultura do Recife • Prefeitura do Recife
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pecas = [
        {
          id: 'aurora-dos-lampioes',
          nome: 'Aurora dos Lampiões',
          data: '2024-09-14',
          horario: '19h30',
          classificacao: '12+',
          teatro: 'Teatro Santa Isabel',
          genero: 'Drama histórico',
          duracao: '120 min',
          sinopse: 'Uma fábula nordestina que mistura cordel, música ao vivo e teatro físico para revisitar os bastidores da resistência cultural de Lampião, explorando memórias, afetos e mitos de um Brasil profundo iluminado pelo palco.',
          poster: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=480&q=80',
          fichaTecnica: 'Direção: Lúcia Falcão • Elenco: Coletivo Sertão Vivo • Trilha: João do Pífano'
        },
        {
          id: 'cordas-urbanas',
          nome: 'Cordas Urbanas',
          data: '2024-09-15',
          horario: '20h00',
          classificacao: '14+',
          teatro: 'Teatro Apolo',
          genero: 'Teatro-dança',
          duracao: '85 min',
          sinopse: 'Espetáculo de teatro-dança acompanha uma jovem violinista pelas ruas do Recife Antigo, transformando sons urbanos em poesia cênica com projeções ao vivo, luzes pulsantes e um diálogo entre tradição e tecnologia.',
          poster: 'https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=480&q=80',
          fichaTecnica: 'Direção: Marcelo Dias • Coreografia: Núbia Santos'
        },
        {
          id: 'infancia-marinha',
          nome: 'Infância Marinha',
          data: '2024-09-15',
          horario: '16h00',
          classificacao: 'Livre',
          teatro: 'Parque Dona Lindu',
          genero: 'Infantil musical',
          duracao: '70 min',
          sinopse: 'Produção para todas as idades celebra a cultura caiçara com bonecos gigantes, canções autorais e narrativas sobre a preservação dos manguezais, convidando o público a brincar, cantar e defender a memória das águas.',
          poster: 'https://images.unsplash.com/photo-1503342217505-b0a15ec3261c?auto=format&fit=crop&w=480&q=80',
          fichaTecnica: 'Direção: Grupo Luar do Mangue • Produção: Companhia Barca Boa'
        },
        {
          id: 'noite-de-insomnias',
          nome: 'Noite de Insônias',
          data: '2024-09-18',
          horario: '21h00',
          classificacao: '16+',
          teatro: 'Teatro Luiz Mendonça',
          genero: 'Drama contemporâneo',
          duracao: '95 min',
          sinopse: 'Drama contemporâneo segue três moradores isolados em um edifício histórico durante a madrugada, cruzando memórias fragmentadas, delírios e reflexões sobre saúde mental, solidão urbana e os ruídos da metrópole que não dorme.',
          poster: 'https://images.unsplash.com/photo-1515168833906-d2a3b82b302b?auto=format&fit=crop&w=480&q=80'
        },
        {
          id: 'riso-de-janaina',
          nome: 'O Riso de Janaína',
          data: '2024-09-19',
          horario: '18h30',
          classificacao: '10+',
          teatro: 'Paço do Frevo',
          genero: 'Comédia musical',
          duracao: '90 min',
          sinopse: 'Comédia musical acompanha uma contadora de histórias e sua trupe em viagem pelo Brasil afro-atlântico, unindo frevo, maracatu e samba de roda em números interativos que convidam o público a dançar, rir e celebrar ancestralidades.',
          poster: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?auto=format&fit=crop&w=480&q=80',
          fichaTecnica: 'Direção musical: Sílvia Valença • Dramaturgia: Coletivo Girassol'
        },
        {
          id: 'maresia-electrica',
          nome: 'Maresia Elétrica',
          data: '2024-09-20',
          horario: '22h00',
          classificacao: '18+',
          teatro: 'Teatro Apolo',
          genero: 'Performance imersiva',
          duracao: '80 min',
          sinopse: 'Instalação cênica imersiva mistura teatro documental e música eletrônica para investigar memórias afetivas de trabalhadores portuários, com relatos reais, paisagens sonoras do cais e um ambiente de luzes que vibra com o público.',
          poster: 'https://images.unsplash.com/photo-1517866186838-9d3c2c4a5d73?auto=format&fit=crop&w=480&q=80'
        },
        {
          id: 'mapas-do-vento',
          nome: 'Mapas do Vento',
          data: '2024-09-21',
          horario: '17h00',
          classificacao: 'Livre',
          teatro: 'Teatro Santa Isabel',
          genero: 'Teatro de objetos',
          duracao: '75 min',
          sinopse: 'Peça sensorial combina teatro de objetos e projeções cartográficas para narrar viagens de jangadeiros, convidando a plateia a percorrer memórias de travessias, faróis e ventos guardados em mapas vivos que se revelam a cada cena.',
          poster: 'https://images.unsplash.com/photo-1528712306091-ed0763094c98?auto=format&fit=crop&w=480&q=80'
        },
        {
          id: 'cicatrizes-do-sol',
          nome: 'Cicatrizes do Sol',
          data: '2024-09-22',
          horario: '19h00',
          classificacao: '14+',
          teatro: 'Teatro Luiz Mendonça',
          genero: 'Saga familiar',
          duracao: '110 min',
          sinopse: 'Narrativa épica acompanha gerações de uma família sertaneja lidando com a migração para a capital, ressignificando lembranças de seca, esperança e acolhimento comunitário em cenas que misturam cordel, música e cinema ao vivo.',
          poster: 'https://images.unsplash.com/photo-1528747008803-1f5c1c40c54f?auto=format&fit=crop&w=480&q=80'
        },
        {
          id: 'astro-recitativo',
          nome: 'Astro Recitativo',
          data: '2024-09-25',
          horario: '18h00',
          classificacao: '12+',
          teatro: 'Paço do Frevo',
          genero: 'Teatro científico',
          duracao: '85 min',
          sinopse: 'Teatro científico com projeções de constelações e trilha ao vivo apresenta a jornada de uma astrônoma pernambucana em busca de novas leituras para o céu do hemisfério sul, aproximando ciência, afeto e imaginação coletiva.',
          poster: 'https://images.unsplash.com/photo-1440404653325-ab127d49abc1?auto=format&fit=crop&w=480&q=80',
          fichaTecnica: 'Consultoria científica: Observatório do Recife • Elenco: Companhia Áurea'
        },
        {
          id: 'ensaios-para-amanha',
          nome: 'Ensaios para Amanhã',
          data: '2024-09-27',
          horario: '20h00',
          classificacao: '16+',
          teatro: 'Parque Dona Lindu',
          genero: 'Performance urbana',
          duracao: '90 min',
          sinopse: 'Crônica futurista mistura teatro de rua e performance multimídia, alternando narrativas de resistência climática e cenas de convivência comunitária em espaços públicos, convidando o público a imaginar cidades resilientes e festivas.',
          poster: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=480&q=80'
        },
        {
          id: 'vozes-da-tacaruna',
          nome: 'Vozes da Tacaruna',
          data: '2024-09-28',
          horario: '19h30',
          classificacao: '10+',
          teatro: 'Teatro Luiz Mendonça',
          genero: 'Musical documental',
          duracao: '100 min',
          sinopse: 'Musical documental resgata depoimentos de trabalhadoras da antiga Fábrica Tacaruna, costurando memórias de luta operária, maternidade e solidariedade feminina com canções originais, projeções de arquivo e coreografias coletivas.',
          poster: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=480&q=80'
        }
      ];

      const ordemClassificacao = ['Livre', '10+', '12+', '14+', '16+', '18+'];
      const favoritosKey = 'festival-teatro-recife-favoritos';
      const favoritosSalvos = JSON.parse(localStorage.getItem(favoritosKey) || '[]');
      const favoritos = new Set(favoritosSalvos);

      const catalogoEl = document.getElementById('catalogo');
      const filtroBusca = document.getElementById('filtroBusca');
      const filtroTeatro = document.getElementById('filtroTeatro');
      const filtroClassificacao = document.getElementById('filtroClassificacao');
      const limparFiltros = document.getElementById('limparFiltros');
      const favoritosLista = document.getElementById('favoritosLista');
      const favoritosEmpty = document.getElementById('favoritosEmpty');
      const favoritosCount = document.getElementById('favoritos-count');
      const catalogNav = document.querySelector('.catalog-nav');

      let pecasFiltradas = [...pecas];

      function criarDataHora(peca) {
        if (!peca.data) return null;
        const horarioLimpo = (peca.horario || '00h00').replace('h', ':');
        const [hora = '00', minuto = '00'] = horarioLimpo.split(':');
        const data = new Date(`${peca.data}T${hora.padStart(2, '0')}:${minuto.padStart(2, '0')}:00`);
        if (Number.isNaN(data.getTime())) {
          return new Date(`${peca.data}T00:00:00`);
        }
        return data;
      }

      function obterPartesData(iso) {
        if (!iso) return null;
        const data = new Date(`${iso}T12:00:00`);
        if (Number.isNaN(data.getTime())) return null;
        const dia = data.getDate().toString().padStart(2, '0');
        const mesCurto = data.toLocaleString('pt-BR', { month: 'short' }).replace('.', '').toUpperCase();
        const diaSemana = data.toLocaleString('pt-BR', { weekday: 'short' }).replace('.', '').toUpperCase();
        const dataCompleta = data.toLocaleDateString('pt-BR', {
          weekday: 'long',
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        });
        return {
          dia,
          mesCurto,
          diaSemana,
          dataCompleta,
          ano: data.getFullYear()
        };
      }

      function formatarMesCabecalho(iso) {
        if (!iso) return null;
        const data = new Date(`${iso}T12:00:00`);
        if (Number.isNaN(data.getTime())) return null;
        const mes = data.toLocaleString('pt-BR', { month: 'long' });
        const mesFormatado = mes.charAt(0).toUpperCase() + mes.slice(1);
        return `${mesFormatado}/${data.getFullYear()}`;
      }

      function salvarFavoritos() {
        localStorage.setItem(favoritosKey, JSON.stringify(Array.from(favoritos)));
      }

      function atualizarContagemFavoritos() {
        favoritosCount.textContent = favoritos.size;
      }

      function preencherSelects() {
        const teatros = Array.from(new Set(pecas.map((peca) => peca.teatro))).sort();
        teatros.forEach((teatro) => {
          const option = document.createElement('option');
          option.value = teatro;
          option.textContent = teatro;
          filtroTeatro.appendChild(option);
        });

        ordemClassificacao.forEach((classificacao) => {
          if (pecas.some((peca) => peca.classificacao === classificacao)) {
            const option = document.createElement('option');
            option.value = classificacao;
            option.textContent = classificacao;
            filtroClassificacao.appendChild(option);
          }
        });
      }

      function aplicarFiltros() {
        const termoBusca = filtroBusca.value.trim().toLowerCase();
        const teatroSelecionado = filtroTeatro.value;
        const classificacaoSelecionada = filtroClassificacao.value;

        pecasFiltradas = pecas.filter((peca) => {
          const atendeBusca =
            !termoBusca ||
            `${peca.nome} ${peca.teatro} ${peca.sinopse} ${peca.genero || ''} ${peca.fichaTecnica || ''}`
              .toLowerCase()
              .includes(termoBusca);
          const atendeTeatro = !teatroSelecionado || peca.teatro === teatroSelecionado;
          const atendeClassificacao = !classificacaoSelecionada || peca.classificacao === classificacaoSelecionada;
          return atendeBusca && atendeTeatro && atendeClassificacao;
        }).sort((a, b) => {
          const dataA = criarDataHora(a);
          const dataB = criarDataHora(b);
          if (dataA && dataB && dataA.getTime() !== dataB.getTime()) {
            return dataA.getTime() - dataB.getTime();
          }
          if (dataA && !dataB) return -1;
          if (!dataA && dataB) return 1;
          return a.nome.localeCompare(b.nome, 'pt-BR');
        });

        renderizarCatalogo();
      }

      function renderizarCatalogo() {
        catalogoEl.innerHTML = '';

        if (!pecasFiltradas.length) {
          const vazio = document.createElement('div');
          vazio.className = 'col';
          vazio.innerHTML = '<div class="card card-programa play-card h-100"><div class="card-body text-center py-5"><p class="mb-2">Nenhuma peça encontrada com os filtros selecionados.</p><small class="muted">Experimente ajustar os campos ou limpe a busca.</small></div></div>';
          catalogoEl.appendChild(vazio);
          return;
        }

        let mesAtual = '';

        pecasFiltradas.forEach((peca) => {
          const partesData = obterPartesData(peca.data);
          const mesCabecalho = formatarMesCabecalho(peca.data);
          if (mesCabecalho && mesCabecalho !== mesAtual) {
            mesAtual = mesCabecalho;
            const divisor = document.createElement('div');
            divisor.className = 'col-12';
            divisor.innerHTML = `<h3 class="month-divider">${mesCabecalho}</h3>`;
            catalogoEl.appendChild(divisor);
          }

          const col = document.createElement('div');
          col.className = 'col';
          const favoritoAtivo = favoritos.has(peca.id);
          const botaoFavoritoClasse = favoritoAtivo ? 'btn-primary' : 'btn-outline-primary';
          const botaoFavoritoTexto = favoritoAtivo ? 'Favorito' : 'Favoritar';
          const metaHtml = [
            partesData ? `<span><strong>Data</strong> ${partesData.dataCompleta}</span>` : '',
            peca.genero ? `<span><strong>Gênero</strong> ${peca.genero}</span>` : '',
            peca.duracao ? `<span><strong>Duração</strong> ${peca.duracao}</span>` : ''
          ]
            .filter(Boolean)
            .join('');
          const metaSection = metaHtml ? `<div class="catalog-meta">${metaHtml}</div>` : '';
          const badgeData = partesData
            ? `<div class="poster-badge"><span class="day">${partesData.dia}</span><span class="month">${partesData.mesCurto}</span><span class="weekday">${partesData.diaSemana}</span></div>`
            : '';
          col.innerHTML = `
            <article class="card card-programa h-100 play-card">
              <div class="poster-wrapper ratio ratio-2x3">
                <img src="${peca.poster}" alt="Pôster do espetáculo ${peca.nome}" class="w-100 h-100" style="object-fit: cover;">
                ${badgeData}
              </div>
              <div class="card-body d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start gap-2 mb-2">
                  <div>
                    <h3 class="h5 mb-1">${peca.nome}</h3>
                    <p class="muted text-uppercase small mb-0">${peca.teatro}${peca.horario ? ` • ${peca.horario}` : ''}</p>
                  </div>
                  <span class="badge text-bg-primary flex-shrink-0">${peca.classificacao}</span>
                </div>
                <p class="card-text flex-grow-1 mb-0" style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">${peca.sinopse}</p>
                ${metaSection}
                <div class="mt-3 d-flex gap-2">
                  <button type="button" class="btn btn-primary btn-sm btn-detalhes" data-bs-toggle="modal" data-bs-target="#detalhesModal" data-id="${peca.id}">Detalhes</button>
                  <button type="button" class="btn ${botaoFavoritoClasse} btn-sm btn-fav" data-id="${peca.id}" aria-pressed="${favoritoAtivo}"><span class="fav-icon" aria-hidden="true">★</span>${botaoFavoritoTexto}</button>
                </div>
              </div>
            </article>
          `;
          catalogoEl.appendChild(col);
        });
      }

      function renderizarFavoritos() {
        favoritosLista.innerHTML = '';
        if (!favoritos.size) {
          favoritosEmpty.classList.remove('d-none');
          return;
        }
        favoritosEmpty.classList.add('d-none');

        const favoritosDados = pecas
          .filter((peca) => favoritos.has(peca.id))
          .sort((a, b) => a.nome.localeCompare(b.nome, 'pt-BR'));

        favoritosDados.forEach((peca) => {
          const item = document.createElement('div');
          item.className = 'list-group-item list-group-item-action d-flex align-items-center gap-3';
          const partesData = obterPartesData(peca.data);
          const dataResumo = partesData ? `${partesData.dia}/${partesData.mesCurto}` : '';
          item.innerHTML = `
            <div class="flex-grow-1">
              <div class="fw-semibold">${peca.nome}</div>
              <small>${peca.teatro}${peca.horario ? ` • ${peca.horario}` : ''}</small>
              ${dataResumo ? `<small class="d-block text-uppercase muted">${dataResumo}</small>` : ''}
            </div>
            <span class="badge text-bg-primary ms-auto">${peca.classificacao}</span>
            <button type="button" class="btn btn-link text-decoration-none text-danger btn-sm remover-favorito" data-id="${peca.id}">Remover</button>
          `;
          favoritosLista.appendChild(item);
        });
      }

      catalogoEl.addEventListener('click', (event) => {
        const detalhesBtn = event.target.closest('.btn-detalhes');
        const favoritoBtn = event.target.closest('.btn-fav');

        if (detalhesBtn) {
          const pecaId = detalhesBtn.getAttribute('data-id');
          const pecaSelecionada = pecas.find((p) => p.id === pecaId);
          if (!pecaSelecionada) return;
          preencherModal(pecaSelecionada);
        }

        if (favoritoBtn) {
          const pecaId = favoritoBtn.getAttribute('data-id');
          if (favoritos.has(pecaId)) {
            favoritos.delete(pecaId);
          } else {
            favoritos.add(pecaId);
          }
          salvarFavoritos();
          atualizarContagemFavoritos();
          renderizarCatalogo();
          renderizarFavoritos();
        }
      });

      favoritosLista.addEventListener('click', (event) => {
        const removerBtn = event.target.closest('.remover-favorito');
        if (removerBtn) {
          const pecaId = removerBtn.getAttribute('data-id');
          favoritos.delete(pecaId);
          salvarFavoritos();
          atualizarContagemFavoritos();
          renderizarCatalogo();
          renderizarFavoritos();
        }
      });

      const detalhesModal = document.getElementById('detalhesModal');
      detalhesModal.addEventListener('show.bs.modal', (event) => {
        const trigger = event.relatedTarget;
        if (!trigger) return;
        const pecaId = trigger.getAttribute('data-id');
        const pecaSelecionada = pecas.find((p) => p.id === pecaId);
        if (pecaSelecionada) {
          preencherModal(pecaSelecionada);
        }
      });

      function preencherModal(peca) {
        const modalTitulo = document.getElementById('modalTitulo');
        const modalTeatro = document.getElementById('modalTeatro');
        const modalClassificacao = document.getElementById('modalClassificacao');
        const modalData = document.getElementById('modalData');
        const modalHorario = document.getElementById('modalHorario');
        const modalSinopse = document.getElementById('modalSinopse');
        const modalPoster = document.getElementById('modalPoster');
        const modalFichaTecnica = document.getElementById('modalFichaTecnica');
        const modalFichaTexto = document.getElementById('modalFichaTexto');
        const modalHighlights = document.getElementById('modalHighlights');
        const partesData = obterPartesData(peca.data);

        modalTitulo.textContent = peca.nome;
        modalTeatro.textContent = peca.teatro;
        modalClassificacao.textContent = peca.classificacao;
        if (partesData) {
          modalData.textContent = partesData.dataCompleta;
          modalData.classList.remove('d-none');
        } else {
          modalData.textContent = '';
          modalData.classList.add('d-none');
        }
        if (peca.horario) {
          modalHorario.textContent = `Horário ${peca.horario}`;
          modalHorario.classList.remove('d-none');
        } else {
          modalHorario.textContent = '';
          modalHorario.classList.add('d-none');
        }
        modalSinopse.textContent = peca.sinopse;
        modalPoster.src = peca.poster;
        modalPoster.alt = `Pôster em destaque do espetáculo ${peca.nome}`;

        modalHighlights.innerHTML = '';
        if (peca.genero) {
          const generoPill = document.createElement('span');
          generoPill.className = 'highlight-pill';
          generoPill.textContent = peca.genero;
          modalHighlights.appendChild(generoPill);
        }
        if (peca.duracao) {
          const duracaoPill = document.createElement('span');
          duracaoPill.className = 'highlight-pill';
          duracaoPill.textContent = `Duração ${peca.duracao}`;
          modalHighlights.appendChild(duracaoPill);
        }

        if (peca.fichaTecnica) {
          modalFichaTexto.textContent = peca.fichaTecnica;
          modalFichaTecnica.classList.remove('d-none');
        } else {
          modalFichaTecnica.classList.add('d-none');
          modalFichaTexto.textContent = '';
        }
      }

      filtroBusca.addEventListener('input', aplicarFiltros);
      filtroTeatro.addEventListener('change', aplicarFiltros);
      filtroClassificacao.addEventListener('change', aplicarFiltros);

      limparFiltros.addEventListener('click', () => {
        filtroBusca.value = '';
        filtroTeatro.value = '';
        filtroClassificacao.value = '';
        aplicarFiltros();
        if (catalogNav) {
          catalogNav.querySelectorAll('button').forEach((btn) => {
            const isReset = btn.getAttribute('data-action') === 'reset';
            btn.classList.toggle('active', isReset);
            btn.setAttribute('aria-pressed', isReset ? 'true' : 'false');
          });
        }
      });

      if (catalogNav) {
        catalogNav.addEventListener('click', (event) => {
          const button = event.target.closest('button');
          if (!button) return;
          const action = button.getAttribute('data-action');
          const focusActions = ['focus-busca', 'focus-teatro', 'focus-classificacao'];
          if (!focusActions.includes(action)) {
            catalogNav.querySelectorAll('button').forEach((btn) => {
              const isActive = btn === button;
              btn.classList.toggle('active', isActive);
              btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
            });
          }

          switch (action) {
            case 'reset':
              filtroBusca.value = '';
              filtroTeatro.value = '';
              filtroClassificacao.value = '';
              aplicarFiltros();
              filtroBusca.focus();
              break;
            case 'focus-busca':
              filtroBusca.focus();
              break;
            case 'focus-teatro':
              filtroTeatro.focus();
              break;
            case 'focus-classificacao':
              filtroClassificacao.focus();
              break;
            case 'buscar-direcao':
              filtroBusca.value = 'direção';
              aplicarFiltros();
              filtroBusca.focus();
              break;
            case 'buscar-elenco':
              filtroBusca.value = 'elenco';
              aplicarFiltros();
              filtroBusca.focus();
              break;
            default:
              break;
          }
        });
      }

      preencherSelects();
      aplicarFiltros();
      atualizarContagemFavoritos();
      renderizarFavoritos();
    });
  </script>
</body>
</html>
