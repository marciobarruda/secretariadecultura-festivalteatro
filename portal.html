<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Festival de Teatro do Recife • Catálogo</title>
    <link
      rel="icon"
      href="https://statics.recife.pe.gov.br/images/dynamics/conecta/icons/favicon.png?w=32&h=32&fit=fill&border=2,transparent,shrink"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* manter todo o CSS existente exatamente como fornecido,
         pois já está alinhado com a identidade visual da PCR */
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }
      *,
      *::before,
      *::after { box-sizing: border-box; }
      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }
      header.site-header {
        background: url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000") center/cover no-repeat;
        color: #fff;
        padding: 3rem 0 2.25rem;
      }
      header .lead {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        line-height: 1.65;
        max-width: 100%;
      }
      .badge-open {
        display: inline-flex; align-items: center; gap: .5rem;
        font-size: .95rem; font-weight: 600; padding: .45rem .9rem; border-radius: 999px;
        background: rgba(255,255,255,.14);
      }
      .section-title {
        display: flex; align-items: center; gap: .65rem; font-weight: 700; font-size: 1.2rem; color: var(--text-strong);
      }
      .section-title::before { content: ""; display: inline-block; width: 32px; height: 3px; border-radius: 999px; background: var(--brand-highlight); }
      .card { border-radius: 4px; overflow: hidden; }
      .card-programa {
        border: 1px solid rgba(0,83,164,.08); border-radius: 4px; background: var(--surface-strong);
        box-shadow: 0 16px 34px rgba(0,45,98,.08);
      }
      .card-programa .card-header {
        border-bottom: 1px solid rgba(0,83,164,.08);
        background: linear-gradient(180deg,#fff 0%,#f5f8fc 100%);
        padding: 1.25rem 1.25rem 1rem;
      }
      .muted { color: var(--text-muted); }
      .catalog-grid { row-gap: 1.25rem; }
      .play-card .ratio { background: #e9eef7; }
      .play-card .badge { font-weight: 600; }
      .btn-fav[aria-pressed="true"] .fav-icon { filter: saturate(1.4); }
      .offcanvas .list-group-item small { color: var(--text-muted); }
      /* manter os estilos responsivos existentes… */
      /* …demais regras (tabelas, recibo etc.) podem permanecer sem uso, não remover */
    </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="d-flex flex-column flex-lg-row align-items-lg-end justify-content-between gap-3">
        <div>
          <span class="badge-open mb-3">Programação aberta</span>
          <h1 class="display-5 fw-bold mb-2">Festival de Teatro do Recife</h1>
          <p class="lead mb-0">De 10 a 24 de setembro, os palcos da cidade recebem produções autorais, companhias convidadas e oficinas especiais.</p>
        </div>
        <button class="btn btn-outline-light align-self-lg-start" type="button" data-bs-toggle="offcanvas" data-bs-target="#favoritosOffcanvas" aria-controls="favoritosOffcanvas">
          Favoritos <span class="badge bg-light text-primary ms-2" id="contadorFavoritos">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="py-5">
    <section class="pb-4">
      <div class="container">
        <div class="card card-programa">
          <div class="card-body">
            <form class="row g-3 align-items-end" id="filtrosForm">
              <div class="col-12 col-lg-4">
                <label for="buscaInput" class="form-label muted text-uppercase small fw-semibold">Buscar</label>
                <input type="search" class="form-control" id="buscaInput" placeholder="Digite nome da peça, teatro ou palavra-chave" />
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="teatroSelect" class="form-label muted text-uppercase small fw-semibold">Teatro</label>
                <select class="form-select" id="teatroSelect">
                  <option value="">Todos</option>
                </select>
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="classificacaoSelect" class="form-label muted text-uppercase small fw-semibold">Classificação</label>
                <select class="form-select" id="classificacaoSelect">
                  <option value="">Todas</option>
                </select>
              </div>
              <div class="col-12 col-lg-2 d-flex">
                <button type="button" class="btn btn-outline-primary w-100 mt-auto" id="limparFiltros">Limpar filtros</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="section-title mb-0">Catálogo de peças</h2>
          <small class="text-muted" id="contadorResultados">0 apresentações</small>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4 catalog-grid" id="catalogoContainer" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <footer class="py-4 border-top" style="background: var(--surface-strong);">
    <div class="container text-center">
      <small class="muted">Secretaria de Cultura do Recife • Prefeitura do Recife</small>
    </div>
  </footer>

  <div class="modal fade" id="detalhesModal" tabindex="-1" aria-labelledby="detalhesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detalhesModalLabel">Detalhes da peça</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <div class="col-12 col-md-5">
              <div class="ratio ratio-2x3 bg-light rounded">
                <img src="" alt="Pôster da peça" class="w-100 h-100 object-fit-cover" id="modalPoster" />
              </div>
            </div>
            <div class="col-12 col-md-7">
              <h3 class="h4" id="modalTitulo"></h3>
              <div class="d-flex align-items-center gap-2 mb-3">
                <span class="badge bg-primary" id="modalClassificacao"></span>
                <span class="muted" id="modalTeatro"></span>
              </div>
              <p class="mb-0" id="modalSinopse"></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="favoritosOffcanvas" aria-labelledby="favoritosOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="favoritosOffcanvasLabel">Favoritos</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <div class="list-group list-group-flush mb-3" id="listaFavoritos"></div>
      <p class="muted small mb-0" id="favoritosVazio">Nenhuma peça favoritada ainda. Escolha suas preferidas no catálogo.</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const pecas = [
      {
        id: "tempestade-sombria",
        nome: "A Tempestade Sombria",
        classificacao: "12+",
        teatro: "Teatro Santa Isabel",
        sinopse:
          "Um coletivo de atores recifenses reimagina a obra clássica de Shakespeare, misturando música eletrônica e projeções para narrar as relações de poder, perdão e afeto em uma ilha misteriosa do Atlântico.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "vozes-do-frevo",
        nome: "Vozes do Frevo",
        classificacao: "Livre",
        teatro: "Paço do Frevo",
        sinopse:
          "Documentário cênico que mistura teatro, dança e depoimentos reais para contar a trajetória de mestres do frevo que mantêm viva a tradição da música e da dança pelas gerações nas ruas do Recife.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "maresia",
        nome: "Maresia",
        classificacao: "14+",
        teatro: "Teatro Apolo",
        sinopse:
          "Uma dramaturgia autoral que acompanha a vida de pescadores da RMR diante das mudanças climáticas. Com cenografia imersiva e música ao vivo, a peça provoca reflexões sobre memória, pertencimento e resistência comunitária.",
        poster: "https://assets.bileto.sympla.com.br/eventmanager/production/gr8ca4bpfsukhu930gu1s4e23j052pl35o0bgji1o6ebt6vdho17om62mobpdh4svlfspuad73stmbc56e252cocmst0q78bd2mr4g.webp"
      },
      {
        id: "cicatrizes",
        nome: "Cicatrizes Invisíveis",
        classificacao: "16+",
        teatro: "Teatro Luiz Mendonça",
        sinopse:
          "Espetáculo de teatro-documentário que reúne relatos de mulheres de diferentes gerações sobre autocuidado e redes de apoio. A encenação utiliza projeções de cartas, fotografias e gravações originais para compor a narrativa.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "infancia-sonhada",
        nome: "Infância Sonhada",
        classificacao: "10+",
        teatro: "Parque Dona Lindu",
        sinopse:
          "Espetáculo ao ar livre com acrobacias, bonecos gigantes e trilha original que convida o público a revisitar memórias de infância, valorizando brincadeiras populares e histórias contadas nos quintais do Recife.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "nuvem",
        nome: "Nuvem de Pássaros",
        classificacao: "Livre",
        teatro: "Teatro Santa Isabel",
        sinopse:
          "Grupo de teatro infantil explora histórias inspiradas em mitos amazônicos com recursos de sombras, manipulação de objetos e canções originais, convidando crianças e adultos para uma jornada poética pelo céu nordestino.",
        poster: "https://assets.bileto.sympla.com.br/eventmanager/production/gr8ca4bpfsukhu930gu1s4e23j052pl35o0bgji1o6ebt6vdho17om62mobpdh4svlfspuad73stmbc56e252cocmst0q78bd2mr4g.webp"
      },
      {
        id: "ensaio",
        nome: "Ensaio Sobre o Fim",
        classificacao: "18+",
        teatro: "Teatro Apolo",
        sinopse:
          "Três performers investigam histórias reais de colapsos urbanos e ambientais para propor novos futuros possíveis. A montagem combina instalações sonoras, dramaturgia fragmentada e momentos de improvisação com o público.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "aurora",
        nome: "Aurora no Recife",
        classificacao: "12+",
        teatro: "Teatro Luiz Mendonça",
        sinopse:
          "Combinando teatro físico e música instrumental, a peça acompanha uma pesquisadora que retorna à cidade natal após décadas no exterior para reconstruir memórias familiares e enfrentar segredos guardados pela comunidade.",
        poster: "https://assets.bileto.sympla.com.br/eventmanager/production/gr8ca4bpfsukhu930gu1s4e23j052pl35o0bgji1o6ebt6vdho17om62mobpdh4svlfspuad73stmbc56e252cocmst0q78bd2mr4g.webp"
      },
      {
        id: "mar-de-gente",
        nome: "Mar de Gente",
        classificacao: "14+",
        teatro: "Paço do Frevo",
        sinopse:
          "Um coral cênico formado por moradores da comunidade do Pilar ocupa o Paço com relatos sobre identidade, festas populares e futuro. A encenação interativa convida a plateia a circular pelo espaço e participar dos cantos.",
        poster: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT9bPxa7RCz9OF_hHSNY3ETnRlyhRbarip5pAFenuVB35HB2r7LDh4CLKrUHKihMnYDkUs&usqp=CAU"
      },
      {
        id: "cidade-invisivel",
        nome: "Cidade Invisível",
        classificacao: "16+",
        teatro: "Teatro Apolo",
        sinopse:
          "Inspirado em narrativas de Italo Calvino, o espetáculo leva o público a percorrer cartografias afetivas do Recife contemporâneo, misturando performances itinerantes, projeções urbanas e trilha composta por artistas locais.",
        poster: "https://assets.bileto.sympla.com.br/eventmanager/production/gr8ca4bpfsukhu930gu1s4e23j052pl35o0bgji1o6ebt6vdho17om62mobpdh4svlfspuad73stmbc56e252cocmst0q78bd2mr4g.webp"
      }
    ];

    const catalogoContainer = document.getElementById("catalogoContainer");
    const contadorResultados = document.getElementById("contadorResultados");
    const buscaInput = document.getElementById("buscaInput");
    const teatroSelect = document.getElementById("teatroSelect");
    const classificacaoSelect = document.getElementById("classificacaoSelect");
    const limparFiltrosBtn = document.getElementById("limparFiltros");
    const listaFavoritos = document.getElementById("listaFavoritos");
    const favoritosVazio = document.getElementById("favoritosVazio");
    const contadorFavoritos = document.getElementById("contadorFavoritos");

    const modalTitulo = document.getElementById("modalTitulo");
    const modalTeatro = document.getElementById("modalTeatro");
    const modalClassificacao = document.getElementById("modalClassificacao");
    const modalSinopse = document.getElementById("modalSinopse");
    const modalPoster = document.getElementById("modalPoster");

    const favoritosKey = "festival-teatro-favoritos";
    const favoritos = new Set(JSON.parse(localStorage.getItem(favoritosKey) || "[]"));

    function atualizarSelects() {
      const teatros = Array.from(new Set(pecas.map((peca) => peca.teatro))).sort();
      const classificacoes = Array.from(new Set(pecas.map((peca) => peca.classificacao))).sort((a, b) => {
        const order = ["Livre", "10+", "12+", "14+", "16+", "18+"];
        return order.indexOf(a) - order.indexOf(b);
      });

      teatros.forEach((teatro) => {
        const option = document.createElement("option");
        option.value = teatro;
        option.textContent = teatro;
        teatroSelect.appendChild(option);
      });

      classificacoes.forEach((classificacao) => {
        const option = document.createElement("option");
        option.value = classificacao;
        option.textContent = classificacao;
        classificacaoSelect.appendChild(option);
      });
    }

    function criarCard(peca) {
      const col = document.createElement("div");
      col.className = "col";

      const card = document.createElement("article");
      card.className = "card play-card h-100 shadow-sm";
      card.innerHTML = `
        <div class="ratio ratio-2x3">
          <img src="${peca.poster}" alt="Pôster da peça ${peca.nome}" class="w-100 h-100 object-fit-cover" />
        </div>
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h3 class="h5 mb-0">${peca.nome}</h3>
            <span class="badge bg-primary">${peca.classificacao}</span>
          </div>
          <p class="muted small mb-3">${peca.teatro}</p>
          <p class="small mb-4" style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">
            ${peca.sinopse}
          </p>
          <div class="mt-auto d-flex gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm w-50" data-action="detalhes" data-id="${peca.id}" data-bs-toggle="modal" data-bs-target="#detalhesModal">Detalhes</button>
            <button type="button" class="btn btn-outline-secondary btn-sm w-50 btn-fav" data-action="favoritar" data-id="${peca.id}" aria-pressed="${favoritos.has(peca.id)}">
              <span class="fav-icon">&#9829;</span> Favoritar
            </button>
          </div>
        </div>
      `;

      col.appendChild(card);
      return col;
    }

    function aplicarFiltros() {
      const termo = buscaInput.value.trim().toLowerCase();
      const teatro = teatroSelect.value;
      const classificacao = classificacaoSelect.value;

      const filtradas = pecas.filter((peca) => {
        const buscaTexto = [peca.nome, peca.teatro, peca.sinopse]
          .join(" ")
          .toLowerCase()
          .includes(termo);
        const teatroOk = teatro ? peca.teatro === teatro : true;
        const classificacaoOk = classificacao ? peca.classificacao === classificacao : true;
        return buscaTexto && teatroOk && classificacaoOk;
      });

      renderizarCatalogo(filtradas);
    }

    function renderizarCatalogo(lista) {
      catalogoContainer.innerHTML = "";
      if (lista.length === 0) {
        const vazio = document.createElement("div");
        vazio.className = "col";
        vazio.innerHTML = `
          <div class="card card-programa h-100 d-flex align-items-center justify-content-center text-center p-4">
            <p class="mb-0">Nenhuma peça encontrada com os filtros aplicados.</p>
          </div>
        `;
        catalogoContainer.appendChild(vazio);
      } else {
        lista.forEach((peca) => catalogoContainer.appendChild(criarCard(peca)));
      }
      contadorResultados.textContent = `${lista.length} ${lista.length === 1 ? "apresentação" : "apresentações"}`;
      sincronizarFavoritos();
    }

    function atualizarModal(peca) {
      modalTitulo.textContent = peca.nome;
      modalTeatro.textContent = peca.teatro;
      modalClassificacao.textContent = peca.classificacao;
      modalSinopse.textContent = peca.sinopse;
      modalPoster.src = peca.poster;
      modalPoster.alt = `Pôster da peça ${peca.nome}`;
    }

    function salvarFavoritos() {
      localStorage.setItem(favoritosKey, JSON.stringify(Array.from(favoritos)));
    }

    function sincronizarFavoritos() {
      const botoesFav = document.querySelectorAll(".btn-fav");
      botoesFav.forEach((botao) => {
        const id = botao.dataset.id;
        const ativo = favoritos.has(id);
        botao.setAttribute("aria-pressed", ativo);
        botao.classList.toggle("btn-primary", ativo);
        botao.classList.toggle("btn-outline-secondary", !ativo);
        const icone = ativo ? "&#10084;" : "&#9825;";
        const label = ativo ? "Favorito" : "Favoritar";
        botao.innerHTML = `<span class="fav-icon">${icone}</span> ${label}`;
      });
      atualizarListaFavoritos();
    }

    function atualizarListaFavoritos() {
      listaFavoritos.innerHTML = "";
      if (favoritos.size === 0) {
        favoritosVazio.classList.remove("d-none");
      } else {
        favoritosVazio.classList.add("d-none");
        Array.from(favoritos)
          .map((id) => pecas.find((peca) => peca.id === id))
          .filter(Boolean)
          .forEach((peca) => {
            const item = document.createElement("div");
            item.className = "list-group-item list-group-item-action";
            item.innerHTML = `
              <div class="d-flex align-items-center justify-content-between w-100 gap-3">
                <div class="me-auto">
                  <h6 class="mb-1">${peca.nome}</h6>
                  <small>${peca.teatro}</small>
                </div>
                <span class="badge bg-primary flex-shrink-0">${peca.classificacao}</span>
                <button type="button" class="btn btn-link text-danger p-0 ms-2 flex-shrink-0" data-action="remover-favorito" data-id="${peca.id}">Remover</button>
              </div>
            `;
            listaFavoritos.appendChild(item);
          });
      }
      contadorFavoritos.textContent = favoritos.size;
    }

    catalogoContainer.addEventListener("click", (event) => {
      const botao = event.target.closest("button");
      if (!botao) return;
      const id = botao.dataset.id;
      const peca = pecas.find((item) => item.id === id);
      if (!peca) return;

      if (botao.dataset.action === "detalhes") {
        atualizarModal(peca);
      }

      if (botao.dataset.action === "favoritar") {
        if (favoritos.has(id)) {
          favoritos.delete(id);
        } else {
          favoritos.add(id);
        }
        salvarFavoritos();
        sincronizarFavoritos();
      }
    });

    listaFavoritos.addEventListener("click", (event) => {
      const botao = event.target.closest("button[data-action='remover-favorito']");
      if (!botao) return;
      const id = botao.dataset.id;
      favoritos.delete(id);
      salvarFavoritos();
      sincronizarFavoritos();
      aplicarFiltros();
    });

    [buscaInput, teatroSelect, classificacaoSelect].forEach((elemento) => {
      elemento.addEventListener("input", aplicarFiltros);
      elemento.addEventListener("change", aplicarFiltros);
    });

    limparFiltrosBtn.addEventListener("click", () => {
      buscaInput.value = "";
      teatroSelect.value = "";
      classificacaoSelect.value = "";
      aplicarFiltros();
      buscaInput.focus();
    });

    atualizarSelects();
    renderizarCatalogo(pecas);
    atualizarListaFavoritos();
  </script>
</body>
</html>
